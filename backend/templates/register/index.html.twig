{% extends 'base.html.twig' %}

{% block title %}Inscription{% endblock %}

{% block body %}
<div class="container register-page">
    {% for message in app.flashes('success') %}
        <div class="flash-success">{{ message }}</div>
    {% endfor %}
    {% for message in app.flashes('error') %}
        <div class="flash-error">{{ message }}</div>
    {% endfor %}

    <h1>Inscription</h1>

    <form id="register-form" enctype="multipart/form-data">
        <input name="firstname" placeholder="Pr√©nom" required>
        <input name="lastname" placeholder="Nom" required>
        <input name="mail" type="email" placeholder="Email" required>
        <input name="password" type="password" placeholder="Mot de passe" required>
        <input name="phone" placeholder="T√©l√©phone (optionnel)">
        <input type="file" name="profile_picture" accept="image/*">

        <label>Budget (s√©par√© par des virgules) :</label>
        <input name="budget" placeholder="Ex : 1000,2000,3000">

        <label>Activit√©s (s√©par√© par des virgules) :</label>
        <input name="activity" placeholder="Ex : ski,rando,plage">

        <label>Alimentation (s√©par√© par des virgules) :</label>
        <input name="food" placeholder="Ex : vegan,gluten-free,pescatarian">

        <button type="submit">S'inscrire</button>
    </form>

    <p id="message"></p>

    <script>
    document.getElementById('register-form').addEventListener('submit', async e => {
        e.preventDefault();

        const form = e.target;

        const data = {
            firstname: form.firstname.value,
            lastname: form.lastname.value,
            mail: form.mail.value,
            password: form.password.value,
            phone: form.phone.value || null,
            budget: form.budget.value ? form.budget.value.split(',').map(s => s.trim()) : [],
            activity: form.activity.value ? form.activity.value.split(',').map(s => s.trim()) : [],
            food: form.food.value ? form.food.value.split(',').map(s => s.trim()) : []
        };

        const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const json = await res.json();
        document.getElementById('message').innerText =
            res.ok ? 'Inscription r√©ussie üéâ' : json.error;
    });
    </script>
</div>
{% endblock %}
